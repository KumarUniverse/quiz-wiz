<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            background-color: black;
            color: white;
            font-family: 'Open Sans Condensed', sans-serif;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300" rel="stylesheet">
    <script src="stopwatch.js" async></script>
    <link rel="stylesheet" href="quiz-style.css"/>
    <title>Quiz Wiz</title>
</head>
<body>
    <h1>Quiz Wiz</h1>

    <!-- Search bar -->
    <form id="search-form">
        <input type="text" id="topic-input" placeholder="Enter topic name" required>
        <button type="submit">Search</button>
    </form>

    <h2 id="topic-title"></h2>
    <h3><time>00:00:00</time></h3>
    <button id="start" class="button1">start</button>
    <button id="stop" class="button2">stop</button>
    <button id="reset" class="button3">reset</button>

    <div id="quiz-container"></div>

    <button id="submit" class="button4" style="display:none;">Submit</button>

    <h3 id="score" style="display:none;"></h3>

    <script>
        $(document).ready(function() {
            let quizData = [];

            // Search form submit
            $("#search-form").on("submit", function(e) {
                e.preventDefault();
                let topic = $("#topic-input").val();
                $("#topic-title").text("Quiz on: " + topic);

                $.getJSON("/quizlet/" + encodeURIComponent(topic), function(data) {
                    quizData = data.questions;
                    renderQuiz(quizData);
                });
            });

            // Render quiz
            function renderQuiz(questions) {
                $("#quiz-container").empty();
                let qNum = 1;

                questions.forEach(q => {
                    let options = [...q.options];
                    options.sort(() => Math.random() - 0.5); // shuffle

                    let qHtml = `<p>${qNum}. ${q.question}</p><form class="quiz-form" data-answer="${q.answer}">`;

                    options.forEach(opt => {
                        qHtml += `
                            <label>
                                <input type="radio" name="q${qNum}" value="${opt}"> ${opt}<br>
                            </label>`;
                    });

                    qHtml += "</form>";
                    $("#quiz-container").append(qHtml);
                    qNum++;
                });

                $("#submit").show();
                $("#score").hide();
            }

            // Grade on submit
            $("#submit").on("click", function() {
                let total = quizData.length;
                let correct = 0;

                $(".quiz-form").each(function() {
                    let correctAns = $(this).data("answer");
                    let chosen = $(this).find("input[type=radio]:checked").val();

                    if (chosen === correctAns) {
                        correct++;
                    }
                });

                $("#score").text(`You scored ${correct} out of ${total}`).show();
            });
        });
    </script>
</body>
</html>
